# [安全运维规范](https://github.com/zkpgds/blog/issues/6)

=简介=
为了保证生产系统运维工作安全高效的开展，特制定此安全运维规范，以便明确运维职责，标准化运维相关工作，统一运维操作，收敛运维风险敞口，降低安全风险，提高运维工作效率和质量。

=通用规范=

  - 生产网安全需遵守生产网安全规范
  - 所有代码管理必须遵循集团代码分级管理规范  //**参见 [[http://phabricator.huobidev.com/w/dev-rule/%E4%BB%A3%E7%A0%81%E5%88%86%E7%BA%A7/ | 代码分级]]**//
  - 研发流程与集团研发流程保持一致，采用集团统一的构建、发布系统
  - 研发设计与数据库设计符合集团研发相应的设计规范 **//参见 [[ /w/dba/regulation/db_specification/ | 数据库设计规范 ]]//**
  - 日志符合集团研发规范 **//参见 [[ /w/devops/%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1/ | 日志规范 ]]//**
  - 应用规范 //**参见 [[/w/devops/应用部署维护规范/| 应用部署规范]]**//
  - 容器化应用申请规范 //**参见 [[/w/devops/application_apply_template/| 容器化应用部署申请规范]]**//

=生产机器=

  - 机器的申请需要遵循资源申请流程 //**参见 [[http://phabricator.huobidev.com/w/%E7%BB%84%E7%BB%87%E8%B5%84%E4%BA%A7/%E7%BB%84%E7%BB%87%E8%B5%84%E4%BA%A7/%E7%BB%84%E7%BB%87%E7%BA%A7%E6%A0%87%E5%87%86%E8%BF%87%E7%A8%8B/%E9%A1%B9%E7%9B%AE/%E8%BF%90%E7%BB%B4%E7%AE%A1%E7%90%86%E9%83%A8%E9%97%A8%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/ | 运维资源申请规程 ]]//**，由运维团队通过初始化脚本或配置管理工具进行统一初始化  
  - 除运维团队相关负责人员外，其他任何人员不允许接触和拥有生产机器的登录信息（用户名/密码、私钥文件）
  - 除运维团队相关负责人员外，任何其他人员不允许直接或间接登录生产机器，运维人员登录时必须使用指定的双因素认证，目前采用 Yubikey
  - 登录生产机器后不允许修改配置、代码等，防止影响线上系统或造成环境潜在不一致
  - 生产机器需要添加安全审计、入侵检测工具，如 AuditBeat、OSSEC
  - 访问生产机器的密码和密钥符合生产网安全规范，禁止出现弱密码
  - 所有的基础服务，能设置密码的必须设置密码，不能设置密码的（如 Redis）需要报备安全
  - 整个公司采用一致的服务器操作系统版本，服务器软件禁止开启自动更新，操作系统版本的升级按公司整体进行
  - 系统设备的管理人员转岗或离职，必须立即注销该账号的所有权限，并移交所 有设备资产
 
=生产数据库=

  - 数据库的申请需要遵循资源申请流程，由运维团队通过初始化脚本或配置管理工具进行统一初始化  
  - 除运维人员在发生问题进行调查外，任何人不能直接登录数据库所在的服务器
  - 只有负责维护的 DBA 才能拥有所维护数据库的配置管理和数据读写权限
  - 生产库的读权限仅在必要时（如调查问题）才开放给相关研发人员，权限的申请需要经过数据库权限申请流程，权限赋予时考虑使用时间，使用后及时收回
  - 如果有线上数据库查询平台类工具，可以开放给相关研发人员长期读权限，权限的申请需要经过平台权限申请流程，但平台需要对敏感库表进行脱敏处理，防止数据泄露
  - 生产库需要建立白名单机制，仅对指定机器或人员开放
  - DBA须通过堡垒机访问数据库，确保可记录、审计操作数据库行为。
  - 禁止直接操作线上数据库数据。若特殊原因，线上数据的变更必须通过数据变更申请流程，需要研发负责人和运维负责人进行批准，涉及敏感数据（机密、秘密）时需要对应业务和安全介入批准
  - 访问数据库的密码和密钥符合生产网安全规范，禁止出现弱密码

=监控与告警=

  - 所有线上设备需要建立全面的基础资源监控，包括但不限于 CPU、内存、磁盘、IO、流量，并建立相应报警
  - 数据库需要监控 TPS、QPS 和慢查询等，并建立相应报警
  - 所有线上设备需要监控登录记录、非法访问，一经发现及时报警
  - 应用系统对可用性和性能进行监控，并建立相应报警
  - 需要监控系统的关键业务指标，并建立相应报警
  - 建议使用 Zabbix+Datadog+PagerDuty 的监控告警方式
  
=轮值报障=

  - 遵循集团的线上运维报障流程，建立 7x24 的轮值机制 //**参见 [[/w/devops/on-call/|运维值班规范]]**//
  - 所有事故需要建立事故报告，B 级以上事故需要进行 COE //**参见 [[/w/devops/accident_levels/|故障分级标准]]**//
  - 定期进行线上问题分析，持续提高系统质量和稳定性，持续改善运维效率 //**参见  [[/w/事故处理/|事故处理规范]]**//
  
=资源管理=

  - 维护资源清单，定期进行资源使用情况分析，从安全和成本的角度定期复查，确定优化方案
 
=高可用=

  - 保障业务服务的高可用，在多可用区做 HA 部署，避免业务服务单点

=数据备份=

  - 建立多重备份机制：常规备份、全量备份、快照、S3备份
  - 定期检查备份文件是否可用、完整，避免出故障后备份数据不可用
  
=安全=

  - 运维人员办公需遵循集团办公网安全要求
  - 资产清单、Cloudflare 防护策略需同步安全部
  - 建立运维与安全应急响应协作机制，定期演练事故场景
  - 定期对服务器进行漏洞安全扫描
  - 不得自创加密算法，使用标准的加密算法
  - 统一日志收集与分析，需同步安全部

=定期检查=

  - 定期对基础设施进行检查
  - 监控域名的过期时间
  - 及时更新证书，防止过期
  - 对使用到的第三方产品、服务的安全性进行检查

=谨慎操作=

  - 在处理需求和故障时，执行风险命令（如 rm、restart、reboot 等）需再三确认，执行命令前，仔细检查所在服务器、路径
  - 避免在疲劳、不清醒状态下操作服务器，尤其是数据库，出错几率较大
  - 在处理事故时，要考虑处理措施是否会引发连锁故障，重要操作三思而行

=事故分析=

  - 在事故分析时，践行无指责文化，重在定位原因，制定改进措施

=持续学习=

  - DevOpsSec 是知识不断变化的领域，需保持对新技术、安全漏洞、最佳实践的关注

=审批=

  - 业务系统日常运维权限的变更不需要经过安全审批
  - 涉及运营数据的操作，经主管负责人审批后,
  - 涉及如下操作，需经过安全部审批
     - 直接修改线上数据库的操作
     - 涉及核心数据（用户数据、资产数据）的操作
     - 涉及敏感代码的操作
 
=变更记录=
| **文档版本** | V0.1
| **制定部门** | 集团运维
| **审核人**| 
| **变更说明**| 2019-01-1-11，安全与运维讨论创建|

=参考资料=
{F780080}
